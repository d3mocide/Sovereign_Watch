
> sovereign-watch-ui@0.2.0 lint
> eslint . --report-unused-disable-directives --max-warnings 0 --format json

[{"filePath":"/app/eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/App.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1630,1633],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1630,1633],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback } from 'react'\r\nimport TacticalMap from './components/map/TacticalMap'\r\nimport { SidebarLeft } from './components/layouts/SidebarLeft'\r\nimport { SidebarRight } from './components/layouts/SidebarRight'\r\nimport { MainHud } from './components/layouts/MainHud'\r\nimport { TopBar } from './components/layouts/TopBar'\r\nimport { CoTEntity } from './types'\r\nimport { useSystemHealth } from './hooks/useSystemHealth'\r\n\r\n// Event type for intelligence feed\r\ninterface IntelEvent {\r\n    id: string;\r\n    time: Date;\r\n    type: 'new' | 'lost' | 'alert';\r\n    message: string;\r\n    entityType?: 'air' | 'sea';\r\n}\r\n\r\nfunction App() {\r\n  const [trackCounts, setTrackCounts] = useState({ air: 0, sea: 0 });\r\n  const [selectedEntity, setSelectedEntity] = useState<CoTEntity | null>(null);\r\n  const health = useSystemHealth();\r\n  \r\n  // Filter state\r\n  const [filters, setFilters] = useState({\r\n    showAir: true,\r\n    showSea: true,\r\n  });\r\n  \r\n  // Velocity Vector Toggle\r\n  const [showVelocityVectors, setShowVelocityVectors] = useState(() => {\r\n    const saved = localStorage.getItem('showVelocityVectors');\r\n    return saved !== null ? JSON.parse(saved) : false;\r\n  });\r\n\r\n  const handleVelocityVectorToggle = useCallback(() => {\r\n    setShowVelocityVectors((prev: boolean) => {\r\n      const newValue = !prev;\r\n      localStorage.setItem('showVelocityVectors', JSON.stringify(newValue));\r\n      return newValue;\r\n    });\r\n  }, []);\r\n  \r\n  // Intelligence feed events\r\n  const [events, setEvents] = useState<IntelEvent[]>([]);\r\n  \r\n  // Mission management state\r\n  const [missionProps, setMissionProps] = useState<any>(null);\r\n  \r\n  // Add new event to feed (max 50 events)\r\n  const addEvent = useCallback((event: Omit<IntelEvent, 'id' | 'time'>) => {\r\n    setEvents(prev => [{\r\n      ...event,\r\n      id: crypto.randomUUID(),\r\n      time: new Date(),\r\n    }, ...prev].slice(0, 50));\r\n  }, []);\r\n\r\n  const handleFilterChange = (key: 'showAir' | 'showSea', value: boolean) => {\r\n    setFilters(prev => ({ ...prev, [key]: value }));\r\n  };\r\n\r\n  const alertsCount = events.filter(e => e.type === 'alert').length;\r\n\r\n  return (\r\n    <MainHud\r\n      topBar={<TopBar alertsCount={alertsCount} location={missionProps?.currentMission} health={health} showVelocityVectors={showVelocityVectors} onToggleVelocityVectors={handleVelocityVectorToggle} />}\r\n      leftSidebar={\r\n        <SidebarLeft \r\n          trackCounts={trackCounts}\r\n          filters={filters}\r\n          onFilterChange={handleFilterChange}\r\n          events={events}\r\n          missionProps={missionProps}\r\n          health={health}\r\n        />\r\n      }\r\n      rightSidebar={\r\n        <SidebarRight \r\n          entity={selectedEntity} \r\n          onClose={() => setSelectedEntity(null)} \r\n          onCenterMap={(lat, lon) => {\r\n            console.log(\"Centering on:\", lat, lon);\r\n            // Imperative map centering could be handled here via a prop to TacticalMap\r\n          }}\r\n        />\r\n      }\r\n    >\r\n      <TacticalMap \r\n          onCountsUpdate={setTrackCounts} \r\n          filters={filters}\r\n          onEvent={addEvent}\r\n          selectedEntity={selectedEntity}\r\n          onEntitySelect={setSelectedEntity}\r\n          onMissionPropsReady={setMissionProps}\r\n          showVelocityVectors={showVelocityVectors}\r\n      />\r\n    </MainHud>\r\n  )\r\n}\r\n\r\nexport default App\r\n","usedDeprecatedRules":[]},{"filePath":"/app/src/api/missionArea.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/components/layouts/MainHud.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/components/layouts/SidebarLeft.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[534,537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[534,537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[559,562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[559,562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { LayerFilters } from '../widgets/LayerFilters';\r\nimport { SystemStatus } from '../widgets/SystemStatus';\r\nimport { IntelFeed } from '../widgets/IntelFeed';\r\nimport { MissionNavigator } from '../widgets/MissionNavigator';\r\n\r\nimport { SystemHealth } from '../../hooks/useSystemHealth';\r\n\r\ninterface SidebarLeftProps {\r\n  trackCounts: { air: number; sea: number };\r\n  filters: { showAir: boolean; showSea: boolean };\r\n  onFilterChange: (key: 'showAir' | 'showSea', value: boolean) => void;\r\n  events: any[];\r\n  missionProps?: any;\r\n  health?: SystemHealth;\r\n}\r\n\r\nexport const SidebarLeft: React.FC<SidebarLeftProps> = ({ \r\n  trackCounts, \r\n  filters, \r\n  onFilterChange, \r\n  events,\r\n  missionProps,\r\n  health\r\n}) => {\r\n  return (\r\n    <div className=\"flex flex-col h-full gap-4 animate-in fade-in duration-1000\">\r\n      {/* 1. Global Controls Moved to Top */}\r\n      <LayerFilters \r\n        filters={filters} \r\n        onFilterChange={onFilterChange} \r\n      />\r\n\r\n      {/* Mission Navigator */}\r\n      {missionProps && (\r\n        <MissionNavigator\r\n          savedMissions={missionProps.savedMissions || []}\r\n          currentMission={missionProps.currentMission}\r\n          onSwitchMission={missionProps.onSwitchMission}\r\n          onDeleteMission={missionProps.onDeleteMission}\r\n          onPresetSelect={missionProps.onPresetSelect}\r\n        />\r\n      )}\r\n\r\n      {/* 2. System Intelligence Feed */}\r\n      <IntelFeed events={events} />\r\n\r\n      {/* 3. Metrics & Analytics */}\r\n      <SystemStatus trackCounts={trackCounts} />\r\n      \r\n      {/* Visual Tech Metadata */}\r\n      <div className=\"flex items-center justify-between px-1 opacity-20 hover:opacity-100 transition-opacity\">\r\n          <span className=\"text-[8px] tracking-tighter\">SIGINT_PROCESSOR_V4.2</span>\r\n          <span className=\"text-[8px] tracking-tighter tabular-nums\">\r\n              LATENCY: {health ? `${health.latency}MS` : '...'}\r\n          </span>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"/app/src/components/layouts/SidebarRight.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/components/layouts/TimeTracked.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/components/layouts/TopBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/components/map/AltitudeLegend.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/components/map/CoverageCircle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/components/map/MapContextMenu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/components/map/MapTooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/components/map/PollingAreaVisualization.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":12,"column":20,"nodeType":"Identifier","endLine":12,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2565,2568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2565,2568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport { Source, Layer } from 'react-map-gl';\r\n\r\ninterface PollingAreaVisualizationProps {\r\n    center: { lat: number; lon: number } | null;\r\n    radiusNm: number;\r\n}\r\n\r\nexport const PollingAreaVisualization: React.FC<PollingAreaVisualizationProps> = ({ center, radiusNm }) => {\r\n    if (!center) return null;\r\n\r\n    const shapes = useMemo(() => {\r\n        // Constants\r\n        const NM_TO_DEG = 1 / 60;\r\n        \r\n        // 1. Maritime Bounding Box (Rectangle)\r\n        // Matches Python poller calculation\r\n        const latOffset = radiusNm * NM_TO_DEG;\r\n        const cosLat = Math.cos(center.lat * (Math.PI / 180));\r\n        const safeCosLat = Math.max(Math.abs(cosLat), 0.0001); // Prevent division by zero at poles\r\n        const lonOffset = radiusNm * NM_TO_DEG / safeCosLat;\r\n\r\n        const minLat = center.lat - latOffset;\r\n        const maxLat = center.lat + latOffset;\r\n        const minLon = center.lon - lonOffset;\r\n        const maxLon = center.lon + lonOffset;\r\n\r\n        const maritimeBox = {\r\n            type: 'Feature',\r\n            properties: { type: 'maritime' },\r\n            geometry: {\r\n                type: 'Polygon',\r\n                coordinates: [[\r\n                    [minLon, minLat],\r\n                    [maxLon, minLat],\r\n                    [maxLon, maxLat],\r\n                    [minLon, maxLat],\r\n                    [minLon, minLat] // Close loop\r\n                ]]\r\n            }\r\n        };\r\n\r\n        // 2. Aviation Radius (Circle)\r\n        // Generate 64 points\r\n        const points = [];\r\n        for (let i = 0; i <= 64; i++) {\r\n            const angle = (i / 64) * 2 * Math.PI;\r\n            // Simple flat earth approximation for display is sufficient, \r\n            // or use proper geodesic if needed. For visual feedback, this matches the box calculation logic.\r\n            const dLat = (radiusNm * NM_TO_DEG) * Math.cos(angle);\r\n            const dLon = (radiusNm * NM_TO_DEG / safeCosLat) * Math.sin(angle);\r\n            points.push([center.lon + dLon, center.lat + dLat]);\r\n        }\r\n\r\n        const aviationCircle = {\r\n            type: 'Feature',\r\n            properties: { type: 'aviation' },\r\n            geometry: {\r\n                type: 'Polygon',\r\n                coordinates: [points]\r\n            }\r\n        };\r\n\r\n        return {\r\n            type: 'FeatureCollection',\r\n            features: [maritimeBox, aviationCircle]\r\n        };\r\n    }, [center, radiusNm]);\r\n\r\n    return (\r\n        <Source id=\"polling-area-source\" type=\"geojson\" data={shapes as any}>\r\n            {/* Maritime Box - Green Solid Line */}\r\n            <Layer\r\n                id=\"maritime-box-line\"\r\n                type=\"line\"\r\n                paint={{\r\n                    'line-color': '#00ff41',\r\n                    'line-width': 1,\r\n                    // Solid line (dash removed)\r\n                    'line-opacity': 0.8\r\n                }}\r\n                filter={['==', 'type', 'maritime']}\r\n            />\r\n\r\n            {/* Aviation Circle - Cyan Solid Line */}\r\n            <Layer\r\n                id=\"aviation-circle-line\"\r\n                type=\"line\"\r\n                paint={{\r\n                    'line-color': '#00ffff',\r\n                    'line-width': 2,\r\n                    'line-opacity': 0.8\r\n                }}\r\n                filter={['==', 'type', 'aviation']}\r\n            />\r\n        </Source>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"/app/src/components/map/SaveLocationForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/components/map/TacticalMap.tsx","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":3,"column":1,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":3,"endColumn":14,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[120,133],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":5,"column":1,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":5,"endColumn":14,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[185,198],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2289,2292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2289,2292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'props'. Either include it or remove the dependency array. However, 'props' will change when *any* prop changes, so the preferred fix is to destructure the 'props' object outside of the useEffect call and refer to those specific props inside useEffect.","line":76,"column":6,"nodeType":"ArrayExpression","endLine":76,"endColumn":38,"suggestions":[{"desc":"Update the dependencies array to be: [overlay, props, props.onOverlayLoaded]","fix":{"range":[2521,2553],"text":"[overlay, props, props.onOverlayLoaded]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":197,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7142,7145],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7142,7145],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":255,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":255,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9969,9972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9969,9972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'deleteMission', 'handlePresetSelect', and 'handleSwitchMission'. Either include them or remove the dependency array.","line":260,"column":8,"nodeType":"ArrayExpression","endLine":260,"endColumn":60,"suggestions":[{"desc":"Update the dependencies array to be: [savedMissions, currentMission, onMissionPropsReady, deleteMission, handlePresetSelect, handleSwitchMission]","fix":{"range":[10145,10197],"text":"[savedMissions, currentMission, onMissionPropsReady, deleteMission, handlePresetSelect, handleSwitchMission]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'onEvent'. Either include it or remove the dependency array. If 'onEvent' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":524,"column":8,"nodeType":"ArrayExpression","endLine":524,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [onEvent]","fix":{"range":[23164,23166],"text":"[onEvent]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":620,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":620,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27449,27452],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27449,27452],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":641,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":641,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28340,28343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28340,28343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":642,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":642,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28415,28418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28415,28418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":650,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":650,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28846,28849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28846,28849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":651,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":651,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28907,28910],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28907,28910],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":653,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":653,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29029,29032],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29029,29032],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":662,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":662,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29492,29495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29492,29495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":786,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":786,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35149,35152],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35149,35152],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":874,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":874,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38410,38413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38410,38413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":892,"column":13,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":892,"endColumn":26,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[38946,38959],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useRef, useState } from 'react';\r\nimport { Map as GLMap, useControl, MapRef } from 'react-map-gl';\r\n// @ts-ignore\r\nimport { MapboxOverlay } from '@deck.gl/mapbox';\r\n// @ts-ignore\r\nimport { ScatterplotLayer, PathLayer, IconLayer, LineLayer } from '@deck.gl/layers';\r\nimport 'maplibre-gl/dist/maplibre-gl.css';\r\nimport { CoTEntity, TrailPoint } from '../../types';\r\nimport { MapTooltip } from './MapTooltip';\r\nimport { MapContextMenu } from './MapContextMenu';\r\nimport { SaveLocationForm } from './SaveLocationForm';\r\nimport { PollingAreaVisualization } from './PollingAreaVisualization';\r\nimport { AltitudeLegend } from './AltitudeLegend';\r\nimport { useMissionLocations } from '../../hooks/useMissionLocations';\r\nimport { setMissionArea, getMissionArea } from '../../api/missionArea';\r\n\r\n// ============================================================================\r\n// ICON ATLAS â€” Simple chevron markers\r\n// ============================================================================\r\n\r\nconst createIconAtlas = () => {\r\n    const canvas = document.createElement('canvas');\r\n    canvas.width = 128;\r\n    canvas.height = 64;\r\n    const ctx = canvas.getContext('2d')!;\r\n    ctx.fillStyle = 'white';\r\n\r\n    // Simple chevron/triangle for all entities (centered at 32, 32)\r\n    ctx.save();\r\n    ctx.translate(32, 32);\r\n    ctx.beginPath();\r\n    ctx.moveTo(0, -16);      // Top point\r\n    ctx.lineTo(12, 8);       // Bottom right\r\n    ctx.lineTo(0, 4);        // Bottom center (notch)\r\n    ctx.lineTo(-12, 8);      // Bottom left\r\n    ctx.closePath();\r\n    ctx.fill();\r\n    ctx.restore();\r\n\r\n    // Same chevron for vessels (at 96, 32)\r\n    ctx.save();\r\n    ctx.translate(96, 32);\r\n    ctx.beginPath();\r\n    ctx.moveTo(0, -16);\r\n    ctx.lineTo(12, 8);\r\n    ctx.lineTo(0, 4);\r\n    ctx.lineTo(-12, 8);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n    ctx.restore();\r\n\r\n    return {\r\n        url: canvas.toDataURL(),\r\n        width: 128,\r\n        height: 64,\r\n        mapping: {\r\n            aircraft: { x: 0, y: 0, width: 64, height: 64, anchorY: 32, mask: true },\r\n            vessel: { x: 64, y: 0, width: 64, height: 64, anchorY: 32, mask: true }\r\n        }\r\n    };\r\n};\r\n\r\nconst ICON_ATLAS = createIconAtlas();\r\n\r\n\r\n\r\n// DeckGL Overlay Control\r\nfunction DeckGLOverlay(props: any) {\r\n  const overlay = useControl<MapboxOverlay>(() => new MapboxOverlay(props));\r\n  overlay.setProps(props);\r\n  \r\n  useEffect(() => {\r\n      if (props.onOverlayLoaded) {\r\n          props.onOverlayLoaded(overlay);\r\n      }\r\n  }, [overlay, props.onOverlayLoaded]);\r\n\r\n  return null;\r\n}\r\n\r\n// Helper: Simple Haversine Distance in Meters\r\nfunction getDistanceMeters(lat1: number, lon1: number, lat2: number, lon2: number) {\r\n    const R = 6371e3; // metres\r\n    const Ï†1 = lat1 * Math.PI / 180; // Ï†, Î» in radians\r\n    const Ï†2 = lat2 * Math.PI / 180;\r\n    const Î”Ï† = (lat2 - lat1) * Math.PI / 180;\r\n    const Î”Î» = (lon2 - lon1) * Math.PI / 180;\r\n\r\n    const a = Math.sin(Î”Ï† / 2) * Math.sin(Î”Ï† / 2) +\r\n        Math.cos(Ï†1) * Math.cos(Ï†2) *\r\n        Math.sin(Î”Î» / 2) * Math.sin(Î”Î» / 2);\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n\r\n    return R * c;\r\n}\r\n\r\n/** Interpolate between two angles on the shortest arc */\r\nfunction lerpAngle(a: number, b: number, t: number): number {\r\n    const delta = ((b - a + 540) % 360) - 180;\r\n    return (a + delta * t + 360) % 360;\r\n}\r\n\r\n\r\n\r\n/** 10-stop altitude color gradient with gamma correction - TACTICAL THEME (Green->Red) */\r\nconst ALTITUDE_STOPS: [number, [number, number, number]][] = [\r\n    [0.00, [0, 255, 100]],    // Green (ground)\r\n    [0.10, [50, 255, 50]],    // Lime\r\n    [0.20, [150, 255, 0]],    // Yellow-green\r\n    [0.30, [255, 255, 0]],    // Yellow\r\n    [0.40, [255, 200, 0]],    // Gold\r\n    [0.52, [255, 150, 0]],    // Orange\r\n    [0.64, [255, 100, 0]],    // Red-orange\r\n    [0.76, [255, 50, 50]],    // Red\r\n    [0.88, [255, 0, 100]],    // Crimson\r\n    [1.00, [255, 0, 255]],    // Magenta (max alt)\r\n];\r\n\r\nfunction altitudeToColor(altitudeMeters: number, alpha: number = 220): [number, number, number, number] {\r\n    if (altitudeMeters == null || altitudeMeters < 0) return [100, 100, 100, alpha];\r\n    const MAX_ALT = 13000; // meters\r\n    const normalized = Math.min(altitudeMeters / MAX_ALT, 1.0);\r\n    const t = Math.pow(normalized, 0.4); // Gamma compress â€” more variation at low altitudes\r\n\r\n    // Find surrounding stops\r\n    for (let i = 0; i < ALTITUDE_STOPS.length - 1; i++) {\r\n        const [t0, c0] = ALTITUDE_STOPS[i];\r\n        const [t1, c1] = ALTITUDE_STOPS[i + 1];\r\n        if (t >= t0 && t <= t1) {\r\n            const f = (t - t0) / (t1 - t0);\r\n            return [\r\n                Math.round(c0[0] + (c1[0] - c0[0]) * f),\r\n                Math.round(c0[1] + (c1[1] - c0[1]) * f),\r\n                Math.round(c0[2] + (c1[2] - c0[2]) * f),\r\n                alpha,\r\n            ];\r\n        }\r\n    }\r\n    const last = ALTITUDE_STOPS[ALTITUDE_STOPS.length - 1][1];\r\n    return [last[0], last[1], last[2], alpha];\r\n}\r\n\r\n/** Speed-based color for maritime entities (knots) - WATER THEME (Blue->Cyan) */\r\nconst SPEED_STOPS_KTS: [number, [number, number, number]][] = [\r\n    [0,  [0, 50, 150]],     // Dark Blue â€” Anchored/Drifting\r\n    [2,  [0, 100, 200]],    // Medium Blue\r\n    [8,  [0, 150, 255]],    // Bright Blue\r\n    [15, [0, 200, 255]],    // Light Blue\r\n    [25, [200, 255, 255]],  // Cyan/White â€” High speed\r\n];\r\n\r\nfunction speedToColor(speedMs: number, alpha: number = 220): [number, number, number, number] {\r\n    const kts = speedMs * 1.94384;\r\n    for (let i = 0; i < SPEED_STOPS_KTS.length - 1; i++) {\r\n        const [s0, c0] = SPEED_STOPS_KTS[i];\r\n        const [s1, c1] = SPEED_STOPS_KTS[i + 1];\r\n        if (kts >= s0 && kts <= s1) {\r\n            const f = (kts - s0) / (s1 - s0);\r\n            return [\r\n                Math.round(c0[0] + (c1[0] - c0[0]) * f),\r\n                Math.round(c0[1] + (c1[1] - c0[1]) * f),\r\n                Math.round(c0[2] + (c1[2] - c0[2]) * f),\r\n                alpha,\r\n            ];\r\n        }\r\n    }\r\n    // Above max stop\r\n    const last = SPEED_STOPS_KTS[SPEED_STOPS_KTS.length - 1][1];\r\n    return [last[0], last[1], last[2], alpha];\r\n}\r\n\r\n/** Unified color for any entity based on type */\r\nfunction entityColor(entity: CoTEntity, alpha: number = 220): [number, number, number, number] {\r\n    if (entity.type.includes('S')) {\r\n        return speedToColor(entity.speed, alpha);\r\n    }\r\n    return altitudeToColor(entity.altitude, alpha);\r\n}\r\n\r\n/** Deterministic hash from UID for animation phase offset */\r\nfunction uidToHash(uid: string): number {\r\n    let h = 0;\r\n    for (let i = 0; i < uid.length; i++) {\r\n        h += uid.charCodeAt(i);\r\n    }\r\n    return h * 100;\r\n}\r\n\r\n\r\n// Props for TacticalMap\r\ninterface TacticalMapProps {\r\n    onCountsUpdate?: (counts: { air: number; sea: number }) => void;\r\n    filters?: { showAir: boolean; showSea: boolean };\r\n    onEvent?: (event: { type: 'new' | 'lost' | 'alert'; message: string; entityType?: 'air' | 'sea' }) => void;\r\n    selectedEntity: CoTEntity | null;\r\n    onEntitySelect: (entity: CoTEntity | null) => void;\r\n    onMissionPropsReady?: (props: any) => void;\r\n    showVelocityVectors?: boolean;\r\n}\r\n\r\nexport function TacticalMap({ onCountsUpdate, filters, onEvent, selectedEntity, onEntitySelect, onMissionPropsReady, showVelocityVectors }: TacticalMapProps) {\r\n    // Adaptive Zoom Calculation\r\n    const calculateZoom = (radiusNm: number) => {\r\n        const r = Math.max(1, radiusNm);\r\n        return Math.max(2, 14 - Math.log2(r));\r\n    };\r\n\r\n    // Refs for Transient State (No React Re-renders)\r\n    const entitiesRef = useRef<Map<string, CoTEntity>>(new Map());\r\n    const overlayRef = useRef<MapboxOverlay | null>(null);\r\n    const rafRef = useRef<number>();\r\n    const countsRef = useRef({ air: 0, sea: 0 });\r\n    const knownUidsRef = useRef<Set<string>>(new Set()); // Track known UIDs for new/lost events\r\n    const currentMissionRef = useRef<{ lat: number; lon: number; radius_nm: number } | null>(null);\r\n    const prevCourseRef = useRef<Map<string, number>>(new Map());\r\n    const prevSnapshotsRef = useRef<Map<string, { lon: number; lat: number; ts: number }>>(new Map());\r\n    const currSnapshotsRef = useRef<Map<string, { lon: number; lat: number; ts: number }>>(new Map());\r\n    const visualStateRef = useRef<Map<string, { lon: number; lat: number }>>(new Map());\r\n    \r\n\r\n\r\n    // State for UI interactions (causes re-renders but tooltip needs it)\r\n    const [hoveredEntity, setHoveredEntity] = useState<CoTEntity | null>(null);\r\n    // selectedEntity is now passed as prop\r\n    const [hoverPosition, setHoverPosition] = useState<{ x: number; y: number } | null>(null);\r\n\r\n    // Context Menu State\r\n    const [contextMenuPos, setContextMenuPos] = useState<{ x: number; y: number } | null>(null);\r\n    const [contextMenuCoords, setContextMenuCoords] = useState<{ lat: number; lon: number } | null>(null);\r\n\r\n    // Save Location Form State\r\n    const [showSaveForm, setShowSaveForm] = useState(false);\r\n    const [saveFormCoords, setSaveFormCoords] = useState<{ lat: number; lon: number } | null>(null);\r\n\r\n    // Velocity Vector Toggle - use ref for reactivity in animation loop\r\n    const velocityVectorsRef = useRef(showVelocityVectors ?? false);\r\n    \r\n    // Update ref when prop changes\r\n    useEffect(() => {\r\n        if (showVelocityVectors !== undefined) {\r\n            velocityVectorsRef.current = showVelocityVectors;\r\n        }\r\n    }, [showVelocityVectors]);\r\n\r\n    // Mission Management\r\n    const { savedMissions, saveMission, deleteMission } = useMissionLocations();\r\n    const [currentMission, setCurrentMission] = useState<{ lat: number; lon: number; radius_nm: number } | null>(null);\r\n\r\n    // Expose mission management to parent\r\n    useEffect(() => {\r\n        if (onMissionPropsReady) {\r\n            onMissionPropsReady({\r\n                savedMissions,\r\n                currentMission,\r\n                onSwitchMission: (mission: any) => handleSwitchMission(mission),\r\n                onDeleteMission: deleteMission,\r\n                onPresetSelect: handlePresetSelect,\r\n            });\r\n        }\r\n    }, [savedMissions, currentMission, onMissionPropsReady]);\r\n\r\n    // Load active mission state on mount\r\n    // Load active mission state on mount and poll for updates\r\n    useEffect(() => {\r\n        const loadActiveMission = async () => {\r\n            try {\r\n                const mission = await getMissionArea();\r\n                if (mission && mission.lat && mission.lon) {\r\n                    // Only update if mission has actually changed to prevent map resets/clears\r\n                    const prev = currentMissionRef.current;\r\n                    if (!prev || prev.lat !== mission.lat || prev.lon !== mission.lon || prev.radius_nm !== mission.radius_nm) {\r\n                        console.log('ðŸ”„ Syncing with active mission:', mission);\r\n                        // Update state (this will trigger the clear effect below)\r\n                        setCurrentMission({\r\n                            lat: mission.lat,\r\n                            lon: mission.lon,\r\n                            radius_nm: mission.radius_nm\r\n                        });\r\n                        \r\n                        // Sync map view to active mission (Only on actual change)\r\n                        if (mapRef.current) {\r\n                            mapRef.current.flyTo({\r\n                                center: [mission.lon, mission.lat],\r\n                                zoom: calculateZoom(mission.radius_nm),\r\n                                duration: 2000\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            } catch (err) {\r\n                console.warn('Failed to load active mission:', err);\r\n            }\r\n        };\r\n        loadActiveMission();\r\n        // Poll every 2 seconds for external updates\r\n        const timer = setInterval(loadActiveMission, 2000);\r\n        return () => clearInterval(timer);\r\n    }, []);\r\n\r\n    // Clear entities when mission area changes (New Selection, Preset, or External Update)\r\n    useEffect(() => {\r\n        if (currentMission) {\r\n            // Update ref for polling comparison\r\n            currentMissionRef.current = currentMission;\r\n\r\n            console.log('ðŸ§¹ Clearing map entities for new mission parameters...');\r\n            entitiesRef.current.clear();\r\n            knownUidsRef.current.clear();\r\n            prevCourseRef.current.clear();\r\n            prevSnapshotsRef.current.clear();\r\n            currSnapshotsRef.current.clear();\r\n            countsRef.current = { air: 0, sea: 0 };\r\n            onCountsUpdate?.({ air: 0, sea: 0 });\r\n            \r\n            // Clear selection to avoid ghost trails\r\n            onEntitySelect(null);\r\n        }\r\n    }, [currentMission, onCountsUpdate, onEntitySelect]);\r\n\r\n    // Worker Reference\r\n    const workerRef = useRef<Worker | null>(null);\r\n\r\n    // Initial Data Generation (Mock) & Worker Setup\r\n    useEffect(() => {\r\n        // Initialize Worker\r\n        const worker = new Worker(new URL('../../workers/tak.worker.ts', import.meta.url), {\r\n            type: 'module'\r\n        });\r\n        \r\n        // Pass Proto URL (Vite allows importing assets via ?url)\r\n        // We need a way to resolve the proto file URL at runtime.\r\n        // For now, we assume it's served from /tak.proto if we put it in public, \r\n        // OR we try to import it. Let's try the import method if configured, otherwise public.\r\n        // Simplest for now: Assume we will move tak.proto to public folder for easy fetch.\r\n        worker.postMessage({ type: 'init', payload: '/tak.proto' });\r\n\r\n        worker.onmessage = (event: MessageEvent) => {\r\n            const { type, data, status } = event.data;\r\n            if (type === 'status' && status === 'ready') {\r\n                console.log(\"Main Thread: TAK Worker Ready\");\r\n            }\r\n            if (type === 'entity_update') {\r\n               // Handle Decoded Data from Worker\r\n               const entity = data.cotEvent; // Based on our proto structure\r\n               if (entity && entity.uid) {\r\n                   const existing = entitiesRef.current.get(entity.uid);\r\n                   const isNew = !existing && !knownUidsRef.current.has(entity.uid);\r\n                   const newLon = entity.lon;\r\n                   const newLat = entity.lat;\r\n                   const isShip = entity.type?.includes('S');\r\n\r\n                   // Spatial Filter: Drop entities outside active mission area\r\n                   // (Backend should filter, but this cleanup prevents stale data artifacts)\r\n                   const mission = currentMissionRef.current;\r\n                   if (mission) {\r\n                       const distToCenter = getDistanceMeters(newLat, newLon, mission.lat, mission.lon);\r\n                       const maxRadiusM = mission.radius_nm * 1852;\r\n                       \r\n                       // Allow 5% buffer for edge cases, but drop outliers\r\n                       if (distToCenter > maxRadiusM * 1.05) {\r\n                           // If it exists, remove it (it moved out of bounds)\r\n                           if (existing) {\r\n                               entitiesRef.current.delete(entity.uid);\r\n                               knownUidsRef.current.delete(entity.uid);\r\n                               onEvent?.({\r\n                                   type: 'lost',\r\n                                   message: `${isShip ? 'ðŸš¢' : 'âœˆï¸'} ${existing.callsign || entity.uid} (Out of Range)`,\r\n                                   entityType: isShip ? 'sea' : 'air'\r\n                               });\r\n                           }\r\n                           return; // Skip update\r\n                       }\r\n                   }\r\n                   \r\n                   // Build trail from existing positions (max 100 points for rich history)\r\n                   let trail: TrailPoint[] = existing?.trail || [];\r\n                   if (!existing || existing.lon !== newLon || existing.lat !== newLat) {\r\n                       const speed = entity.detail?.track?.speed || 0;\r\n                       trail = [...trail, [newLon, newLat, entity.hae || 0, speed] as TrailPoint].slice(-100);\r\n                   }\r\n                   \r\n                    const callsign = entity.detail?.contact?.callsign?.trim() || entity.uid;\r\n                    \r\n                    // TIMESTAMP CHECK: Prevent \"Sawtooth\" / Time-Travel\r\n                    // If we have a newer update already, ignore this one.\r\n                    const existingEntity = entitiesRef.current.get(entity.uid);\r\n                    \r\n                    // 1. Strict Source Ordering (if both have timestamps)\r\n                    if (existingEntity && existingEntity.lastSourceTime && entity.time) {\r\n                        if (existingEntity.lastSourceTime >= entity.time) {\r\n                            return; // Drop stale AND duplicate packets (Strictly Monotonic)\r\n                        }\r\n                    }\r\n\r\n                    // Snapshot for interpolation (BEFORE updating the entity)\r\n                    const currSnap = currSnapshotsRef.current.get(entity.uid);\r\n                    if (currSnap && (currSnap.lon !== newLon || currSnap.lat !== newLat)) {\r\n                        prevSnapshotsRef.current.set(entity.uid, { ...currSnap });\r\n                    }\r\n                    currSnapshotsRef.current.set(entity.uid, { lon: newLon, lat: newLat, ts: Date.now() });\r\n                    \r\n                    entitiesRef.current.set(entity.uid, {\r\n                        uid: entity.uid,\r\n                        lat: newLat,\r\n                        lon: newLon,\r\n                        altitude: entity.hae || 0, // Height Above Ellipsoid in meters (Proto is flat)\r\n                        type: entity.type,\r\n                        course: entity.detail?.track?.course || 0,\r\n                        speed: entity.detail?.track?.speed || 0,\r\n                        callsign,\r\n                        // SEPARATION OF CONCERNS:\r\n                        // time: The raw source time from the packet\r\n                        // lastSourceTime: The newest source time we have accepted (for ordering)\r\n                        // lastSeen: The local wall-clock time (for fading/stale checks)\r\n                        time: entity.time,\r\n                        lastSourceTime: entity.time || existingEntity?.lastSourceTime, \r\n                        lastSeen: Date.now(), \r\n                        trail,\r\n                        uidHash: 0 // Will be set below\r\n                    });\r\n                    \r\n                    // Pre-compute UID hash for glow animation (once per entity, not per frame)\r\n                    const stored = entitiesRef.current.get(entity.uid)!;\r\n                    if (stored.uidHash == null || stored.uidHash === 0) {\r\n                        stored.uidHash = uidToHash(entity.uid);\r\n                    }\r\n                    \r\n                    // Smooth course transitions\r\n                    const prevCourse = prevCourseRef.current.get(entity.uid);\r\n                    const rawCourse = entity.detail?.track?.course || 0;\r\n                    const smoothedCourse = prevCourse != null ? lerpAngle(prevCourse, rawCourse, 0.18) : rawCourse;\r\n                    prevCourseRef.current.set(entity.uid, smoothedCourse);\r\n                    stored.course = smoothedCourse;\r\n                   \r\n                   // Track known UIDs and emit new entity event\r\n                   if (isNew) {\r\n                       knownUidsRef.current.add(entity.uid);\r\n                       onEvent?.({\r\n                           type: 'new',\r\n                           message: `${isShip ? 'ðŸš¢' : 'âœˆï¸'} ${callsign}`,\r\n                           entityType: isShip ? 'sea' : 'air'\r\n                       });\r\n                   }\r\n\r\n\r\n               }\r\n            }\r\n        };\r\n\r\n        workerRef.current = worker;\r\n        \r\n        // ... (WebSocket Setup - No changes needed here, skipping context to lessen payload) ...\r\n        // Note: In real code replace, I'd probably skip the whole connection block and target specific chunks if they were static.\r\n        // But since I need to replace the animate function too which is further down, and the tool limits chunking...\r\n        // Actually, I can just replace the entity update block above, and then make a separate call for the animate loop.\r\n        // Let's stick to the entity update block first.\r\n\r\n\r\n        // --- WebSocket Setup with Reconnection ---\r\n        const apiUrl = import.meta.env.VITE_API_URL || 'http://localhost:8000';\r\n        const wsUrl = apiUrl.replace(/^http/, 'ws') + '/api/tracks/live';\r\n        \r\n        let ws: WebSocket | null = null;\r\n        let reconnectAttempts = 0;\r\n        const maxReconnectAttempts = 10;\r\n        const baseDelay = 1000; // 1 second\r\n        let reconnectTimeout: number | null = null;\r\n        let isCleaningUp = false;\r\n        \r\n        const connect = () => {\r\n            if (isCleaningUp) return;\r\n            \r\n            console.log(`Connecting to Feed: ${wsUrl} (attempt ${reconnectAttempts + 1})`);\r\n            ws = new WebSocket(wsUrl);\r\n            ws.binaryType = 'arraybuffer';\r\n            \r\n            ws.onopen = () => {\r\n                console.log('Connected to TAK Stream');\r\n                reconnectAttempts = 0; // Reset on successful connection\r\n            };\r\n            \r\n            ws.onmessage = (event) => {\r\n                if (workerRef.current) {\r\n                    workerRef.current.postMessage({ \r\n                        type: 'decode_batch', \r\n                        payload: event.data \r\n                    }, [event.data]); \r\n                }\r\n            };\r\n            \r\n            ws.onerror = () => {\r\n                // Don't log noisy errors - onclose will handle reconnection\r\n            };\r\n            \r\n            ws.onclose = (event) => {\r\n                if (isCleaningUp) return;\r\n                \r\n                // Only log if it was previously connected (not initial failures)\r\n                if (reconnectAttempts === 0 && event.wasClean) {\r\n                    console.log('TAK Stream disconnected');\r\n                }\r\n                \r\n                // Exponential backoff: 1s, 2s, 4s, 8s... max 30s\r\n                if (reconnectAttempts < maxReconnectAttempts) {\r\n                    const delay = Math.min(baseDelay * Math.pow(2, reconnectAttempts), 30000);\r\n                    reconnectAttempts++;\r\n                    console.log(`Reconnecting in ${delay/1000}s...`);\r\n                    reconnectTimeout = window.setTimeout(connect, delay);\r\n                } else {\r\n                    console.error('Max reconnection attempts reached. Please refresh the page.');\r\n                }\r\n            };\r\n        };\r\n        \r\n        connect();\r\n\r\n        return () => {\r\n            isCleaningUp = true;\r\n            if (reconnectTimeout) clearTimeout(reconnectTimeout);\r\n            worker.terminate();\r\n            if (ws) ws.close();\r\n        };\r\n\r\n    }, []);\r\n\r\n    // Animation Loop\r\n    useEffect(() => {\r\n        const animate = () => {\r\n            // 1. Cleanup stale entities\r\n            const entities = entitiesRef.current;\r\n            const now = Date.now();\r\n            const STALE_THRESHOLD_AIR_MS = 120 * 1000;\r\n            const STALE_THRESHOLD_SEA_MS = 300 * 1000;\r\n            \r\n            for (const [uid, entity] of entities) {\r\n                const isShip = entity.type?.includes('S');\r\n                const threshold = isShip ? STALE_THRESHOLD_SEA_MS : STALE_THRESHOLD_AIR_MS;\r\n                \r\n                if (now - entity.lastSeen > threshold) {\r\n                    entities.delete(uid);\r\n                    knownUidsRef.current.delete(uid);\r\n                    prevCourseRef.current.delete(uid);\r\n                    prevSnapshotsRef.current.delete(uid);\r\n                    currSnapshotsRef.current.delete(uid);\r\n                    \r\n                    onEvent?.({\r\n                        type: 'lost',\r\n                        message: `${isShip ? 'ðŸš¢' : 'âœˆï¸'} ${entity.callsign}`,\r\n                        entityType: isShip ? 'sea' : 'air'\r\n                    });\r\n                }\r\n            }\r\n            \r\n            // 2. Report counts\r\n            let airCount = 0;\r\n            let seaCount = 0;\r\n            for (const entity of entities.values()) {\r\n                if (entity.type?.includes('S')) {\r\n                    seaCount++;\r\n                } else {\r\n                    airCount++;\r\n                }\r\n            }\r\n            \r\n            if (countsRef.current.air !== airCount || countsRef.current.sea !== seaCount) {\r\n                countsRef.current = { air: airCount, sea: seaCount };\r\n                onCountsUpdate?.({ air: airCount, sea: seaCount });\r\n            }\r\n            \r\n            // 3. Interpolate\r\n            const interpolated: CoTEntity[] = [];\r\n            for (const entity of entities.values()) {\r\n                const isShip = entity.type?.includes('S');\r\n                if (isShip && !filters?.showSea) continue;\r\n                if (!isShip && !filters?.showAir) continue;\r\n\r\n                const prev = prevSnapshotsRef.current.get(entity.uid);\r\n                const curr = currSnapshotsRef.current.get(entity.uid);\r\n\r\n                let targetLon = entity.lon;\r\n                let targetLat = entity.lat;\r\n\r\n                if (prev && curr && curr.ts > prev.ts) {\r\n                    const elapsed = now - curr.ts;\r\n                    const duration = curr.ts - prev.ts;\r\n                    const t = Math.min(elapsed / Math.max(duration, 100), 2.5); \r\n\r\n                    targetLon = prev.lon + (curr.lon - prev.lon) * t;\r\n                    targetLat = prev.lat + (curr.lat - prev.lat) * t;\r\n                }\r\n\r\n                let visual = visualStateRef.current.get(entity.uid);\r\n                if (!visual) {\r\n                    visual = { lat: targetLat, lon: targetLon };\r\n                } else {\r\n                    const SMOOTH_FACTOR = 0.05;\r\n                    visual.lat = visual.lat + (targetLat - visual.lat) * SMOOTH_FACTOR;\r\n                    visual.lon = visual.lon + (targetLon - visual.lon) * SMOOTH_FACTOR;\r\n                }\r\n                visualStateRef.current.set(entity.uid, visual);\r\n\r\n                interpolated.push({ ...entity, lon: visual.lon, lat: visual.lat });\r\n            }\r\n            \r\n            // 4. Update Layers\r\n            const layers = [\r\n                ...(selectedEntity && interpolated.find(e => e.uid === selectedEntity.uid)\r\n                    ? (() => {\r\n                        const entity = interpolated.find(e => e.uid === selectedEntity.uid)!;\r\n                        if (entity.trail.length < 3) return [];\r\n                        const trailPath = entity.trail.map(p => [p[0], p[1], p[2]]);\r\n                        const isShip = entity.type.includes('S');\r\n                        const trailColor = isShip\r\n                            ? speedToColor(entity.speed, 200)\r\n                            : altitudeToColor(entity.altitude, 200);\r\n\r\n                        return [new PathLayer({\r\n                            id: 'selected-trail',\r\n                            data: [{ path: trailPath }],\r\n                            getPath: (d: any) => d.path,\r\n                            getColor: trailColor,\r\n                            getWidth: 3,\r\n                            widthMinPixels: 2.5,\r\n                            pickable: false,\r\n                            jointRounded: true,\r\n                            capRounded: true,\r\n                            opacity: 1.0,\r\n                        })];\r\n                    })()\r\n                    : []),\r\n\r\n                new IconLayer({\r\n                    id: 'heading-arrows',\r\n                    data: interpolated,\r\n                    getIcon: (d: CoTEntity) => {\r\n                        const isVessel = d.type.includes('S');\r\n                        return isVessel ? 'vessel' : 'aircraft';\r\n                    },\r\n                    iconAtlas: ICON_ATLAS.url,\r\n                    iconMapping: ICON_ATLAS.mapping,\r\n                    getPosition: (d: any) => [d.lon, d.lat, d.altitude || 0],\r\n                    getSize: (d: any) => {\r\n                        const isSelected = selectedEntity?.uid === d.uid;\r\n                        const isVessel = d.type.includes('S');\r\n                        const baseSize = isVessel ? 24 : 32;\r\n                        return isSelected ? baseSize * 1.3 : baseSize;\r\n                    },\r\n                    sizeUnits: 'pixels' as const,\r\n                    billboard: true,\r\n                    getAngle: (d: any) => -(d.course || 0),\r\n                    getColor: (d: any) => entityColor(d as CoTEntity),\r\n                    pickable: true,\r\n                    onHover: (info: { object?: any; x: number; y: number }) => {\r\n                        if (info.object) {\r\n                            setHoveredEntity(info.object as CoTEntity);\r\n                            setHoverPosition({ x: info.x, y: info.y });\r\n                        } else {\r\n                            setHoveredEntity(null);\r\n                            setHoverPosition(null);\r\n                        }\r\n                    },\r\n                    onClick: (info: { object?: any }) => {\r\n                        if (info.object) {\r\n                            const entity = info.object as CoTEntity;\r\n                            const newSelection = selectedEntity?.uid === entity.uid ? null : entity;\r\n                            onEntitySelect(newSelection);\r\n                        } else {\r\n                            onEntitySelect(null);\r\n                        }\r\n                    },\r\n                    updateTriggers: {\r\n                        getSize: [selectedEntity?.uid],\r\n                    }\r\n                }),\r\n\r\n                new ScatterplotLayer({\r\n                    id: 'entity-glow',\r\n                    data: interpolated,\r\n                    getPosition: (d: CoTEntity) => [d.lon, d.lat, d.altitude || 0],\r\n                    getRadius: (d: CoTEntity) => {\r\n                        const isSelected = selectedEntity?.uid === d.uid;\r\n                        const pulse = (Math.sin((now + d.uidHash) / 600) + 1) / 2;\r\n                        const base = isSelected ? 20 : 6;\r\n                        return base * (1 + (pulse * 0.1));\r\n                    },\r\n                    radiusUnits: 'pixels' as const,\r\n                    getFillColor: (d: CoTEntity) => {\r\n                        const isSelected = selectedEntity?.uid === d.uid;\r\n                        const pulse = (Math.sin((now + d.uidHash) / 600) + 1) / 2;\r\n                        const baseAlpha = isSelected ? 60 : 10;\r\n                        const a = baseAlpha * (0.8 + pulse * 0.2);\r\n                        return entityColor(d, a);\r\n                    },\r\n                    pickable: false,\r\n                    updateTriggers: { getRadius: [now], getFillColor: [now] }\r\n                }),\r\n\r\n                ...(selectedEntity ? [\r\n                    new ScatterplotLayer({\r\n                        id: 'selection-ring',\r\n                        data: interpolated.filter(e => e.uid === selectedEntity.uid),\r\n                        getPosition: (d: CoTEntity) => [d.lon, d.lat, d.altitude || 0],\r\n                        getRadius: () => {\r\n                            const cycle = (now % 3000) / 3000;\r\n                            return 15 + cycle * 35;\r\n                        },\r\n                        radiusUnits: 'pixels' as const,\r\n                        getFillColor: [0, 0, 0, 0],\r\n                        getLineColor: () => {\r\n                            const cycle = (now % 3000) / 3000;\r\n                            const alpha = Math.round(180 * (1 - Math.pow(cycle, 2)));\r\n                            return entityColor(selectedEntity, alpha);\r\n                        },\r\n                        getLineWidth: 2,\r\n                        stroked: true,\r\n                        filled: false,\r\n                        pickable: false,\r\n                        updateTriggers: { getRadius: [now], getLineColor: [now] }\r\n                    })\r\n                ] : []),\r\n\r\n                ...(velocityVectorsRef.current ? [\r\n                    new LineLayer({\r\n                        id: 'velocity-vectors',\r\n                        data: interpolated.filter(e => e.speed > 0.5),\r\n                        getSourcePosition: (d: CoTEntity) => [d.lon, d.lat, d.altitude || 0],\r\n                        getTargetPosition: (d: CoTEntity) => {\r\n                            const projectionSeconds = 45;\r\n                            const distMeters = d.speed * projectionSeconds;\r\n                            const courseRad = (d.course || 0) * Math.PI / 180;\r\n                            const R = 6371000;\r\n                            const latRad = d.lat * Math.PI / 180;\r\n                            const dLat = (distMeters * Math.cos(courseRad)) / R;\r\n                            const dLon = (distMeters * Math.sin(courseRad)) / (R * Math.cos(latRad));\r\n                            return [\r\n                                d.lon + dLon * (180 / Math.PI),\r\n                                d.lat + dLat * (180 / Math.PI),\r\n                                d.altitude || 0,\r\n                            ];\r\n                        },\r\n                        getColor: (d: CoTEntity) => entityColor(d, 120),\r\n                        getWidth: 1.5,\r\n                        widthMinPixels: 1,\r\n                        pickable: false,\r\n                    })\r\n                ] : []),\r\n\r\n            ];\r\n\r\n            if (overlayRef.current) {\r\n                overlayRef.current.setProps({ layers });\r\n            }\r\n\r\n            rafRef.current = requestAnimationFrame(animate);\r\n        };\r\n\r\n        const rafId = requestAnimationFrame(animate);\r\n        rafRef.current = rafId;\r\n\r\n        return () => {\r\n            cancelAnimationFrame(rafId);\r\n        };\r\n    }, [selectedEntity, onCountsUpdate, filters, onEvent, onEntitySelect]);\r\n\r\n    const mapToken = import.meta.env.VITE_MAPBOX_TOKEN;\r\n    const mapStyle = mapToken \r\n        ? \"mapbox://styles/mapbox/dark-v11\" \r\n        : \"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json\";\r\n\r\n    // Read center from ENV variables\r\n    const initialLat = parseFloat(import.meta.env.VITE_CENTER_LAT || '45.5152');\r\n    const initialLon = parseFloat(import.meta.env.VITE_CENTER_LON || '-122.6784');\r\n\r\n    const mapRef = useRef<MapRef>(null);\r\n\r\n    const setViewMode = (mode: '2d' | '3d') => {\r\n        if (!mapRef.current) return;\r\n        if (mode === '2d') {\r\n            mapRef.current.flyTo({ pitch: 0, bearing: 0, duration: 2000 });\r\n        } else {\r\n            mapRef.current.flyTo({ pitch: 45, bearing: 0, duration: 2000 });\r\n        }\r\n    };\r\n\r\n    // Mission Area Handlers\r\n    const handleContextMenu = (e: any) => {\r\n        e.preventDefault();\r\n        const { lngLat, point } = e;\r\n        setContextMenuPos({ x: point.x, y: point.y });\r\n        setContextMenuCoords({ lat: lngLat.lat, lon: lngLat.lng });\r\n    };\r\n\r\n    const handleSetFocus = async (lat: number, lon: number) => {\r\n        try {\r\n            const radius = currentMission?.radius_nm || parseInt(import.meta.env.VITE_COVERAGE_RADIUS_NM || '150');\r\n            await setMissionArea({ lat, lon, radius_nm: radius });\r\n            setCurrentMission({ lat, lon, radius_nm: radius });\r\n            \r\n            // Clear old entities when changing mission area\r\n            entitiesRef.current.clear();\r\n            console.log('ðŸ—‘ï¸ Cleared old entities for new mission area');\r\n            \r\n            // Fly map to new location\r\n            if (mapRef.current) {\r\n                mapRef.current.flyTo({\r\n                    center: [lon, lat],\r\n                    zoom: calculateZoom(radius),\r\n                    duration: 2000\r\n                });\r\n            }\r\n            \r\n            console.log(`ðŸ“ Mission area pivoted to: ${lat.toFixed(4)}, ${lon.toFixed(4)}`);\r\n        } catch (error) {\r\n            console.error('Failed to set mission focus:', error);\r\n        }\r\n    };\r\n\r\n    const handleSaveLocation = (lat: number, lon: number) => {\r\n        // Open inline form instead of prompt\r\n        setSaveFormCoords({ lat, lon });\r\n        setShowSaveForm(true);\r\n        setContextMenuPos(null); // Close context menu\r\n    };\r\n\r\n    const handleSaveFormSubmit = (name: string, radius: number) => {\r\n        if (!saveFormCoords) return;\r\n        \r\n        saveMission({ \r\n            name, \r\n            lat: saveFormCoords.lat, \r\n            lon: saveFormCoords.lon, \r\n            radius_nm: radius \r\n        });\r\n        \r\n        console.log(`ðŸ’¾ Saved mission location: ${name}`);\r\n        setShowSaveForm(false);\r\n        setSaveFormCoords(null);\r\n    };\r\n\r\n    const handleSaveFormCancel = () => {\r\n        setShowSaveForm(false);\r\n        setSaveFormCoords(null);\r\n    };\r\n\r\n    const handleReturnHome = async () => {\r\n        const defaultLat = parseFloat(import.meta.env.VITE_CENTER_LAT || '45.5152');\r\n        const defaultLon = parseFloat(import.meta.env.VITE_CENTER_LON || '-122.6784');\r\n        const defaultRadius = parseInt(import.meta.env.VITE_COVERAGE_RADIUS_NM || '150');\r\n\r\n        await handleSetFocus(defaultLat, defaultLon);\r\n        setCurrentMission({ lat: defaultLat, lon: defaultLon, radius_nm: defaultRadius });\r\n    };\r\n\r\n    const handlePresetSelect = async (radius: number) => {\r\n        if (!currentMission) return;\r\n        \r\n        try {\r\n            await setMissionArea({ lat: currentMission.lat, lon: currentMission.lon, radius_nm: radius });\r\n            setCurrentMission({ ...currentMission, radius_nm: radius });\r\n            \r\n            if (mapRef.current) {\r\n                mapRef.current.flyTo({\r\n                    zoom: calculateZoom(radius),\r\n                    duration: 1000\r\n                });\r\n            }\r\n\r\n            console.log(`ðŸ“ Radius updated to ${radius}nm`);\r\n        } catch (error) {\r\n            console.error('Failed to update radius:', error);\r\n        }\r\n    };\r\n\r\n    const handleSwitchMission = async (mission: any) => {\r\n        await handleSetFocus(mission.lat, mission.lon);\r\n        setCurrentMission({ lat: mission.lat, lon: mission.lon, radius_nm: mission.radius_nm });\r\n    };\r\n\r\n    return (\r\n    <>\r\n        <GLMap\r\n            ref={mapRef}\r\n            initialViewState={{\r\n                latitude: initialLat,\r\n                longitude: initialLon,\r\n                zoom: 9,\r\n                pitch: 0,\r\n                bearing: 0\r\n            }}\r\n            mapStyle={mapStyle}\r\n            mapboxAccessToken={mapToken}\r\n            // @ts-ignore\r\n            mapLib={mapToken ? undefined : import('maplibre-gl')}\r\n            style={{width: '100vw', height: '100vh', userSelect: 'none', WebkitUserSelect: 'none'}}\r\n            onContextMenu={handleContextMenu}\r\n            onClick={() => {\r\n                setContextMenuPos(null);\r\n                setContextMenuCoords(null);\r\n            }}\r\n        >\r\n            <DeckGLOverlay \r\n                interleaved={true} \r\n                onOverlayLoaded={(overlay: MapboxOverlay) => {\r\n                    overlayRef.current = overlay;\r\n                }}\r\n            />\r\n            \r\n            {/* Polling Area Visualization based on CURRENT mission state */}\r\n            {currentMission ? (\r\n                <PollingAreaVisualization \r\n                    center={currentMission} \r\n                    radiusNm={currentMission.radius_nm} \r\n                />\r\n            ) : (\r\n                <PollingAreaVisualization \r\n                    center={{ lat: initialLat, lon: initialLon }} \r\n                    radiusNm={parseInt(import.meta.env.VITE_COVERAGE_RADIUS_NM || '150')} \r\n                />\r\n            )}\r\n        </GLMap>\r\n            \r\n        {/* View Controls */}\r\n        {/* View Controls - Centered to avoid sidebar overlap */}\r\n        <div className=\"absolute bottom-8 left-1/2 -translate-x-1/2 flex gap-4 z-[100] pointer-events-auto\">\r\n            <button \r\n                onClick={() => setViewMode('2d')}\r\n                className=\"bg-black/60 hover:bg-black/80 backdrop-blur border border-white/10 text-cyan-400 p-2 rounded shadow-lg transition-all active:scale-95\"\r\n                title=\"Top Down (2D)\"\r\n            >\r\n                <div className=\"w-8 h-8 flex items-center justify-center font-mono font-bold text-xs\">2D</div>\r\n            </button>\r\n            <button \r\n                onClick={() => setViewMode('3d')}\r\n                className=\"bg-black/60 hover:bg-black/80 backdrop-blur border border-white/10 text-cyan-400 p-2 rounded shadow-lg transition-all active:scale-95\"\r\n                title=\"Perspective (3D)\"\r\n            >\r\n                 <div className=\"w-8 h-8 flex items-center justify-center font-mono font-bold text-xs\">3D</div>\r\n            </button>\r\n        </div>\r\n        \r\n        {/* Context Menu */}\r\n        <MapContextMenu\r\n            position={contextMenuPos}\r\n            coordinates={contextMenuCoords}\r\n            onSetFocus={handleSetFocus}\r\n            onSaveLocation={handleSaveLocation}\r\n            onReturnHome={handleReturnHome}\r\n            onClose={() => {\r\n                setContextMenuPos(null);\r\n                setContextMenuCoords(null);\r\n            }}\r\n        />\r\n        \r\n        {/* Save Location Form */}\r\n        {showSaveForm && (\r\n            <SaveLocationForm\r\n                coordinates={saveFormCoords}\r\n                onSave={handleSaveFormSubmit}\r\n                onCancel={handleSaveFormCancel}\r\n            />\r\n        )}\r\n        \r\n\r\n        {/* Modern Map Tooltip */}\r\n        {hoveredEntity && hoverPosition && (\r\n            <MapTooltip entity={hoveredEntity} position={hoverPosition} />\r\n        )}\r\n        \r\n        {/* Altitude Legend (Visible for Air Layer) */}\r\n        <AltitudeLegend visible={filters?.showAir ?? true} />\r\n    </>\r\n    );\r\n};\r\n\r\n\r\n\r\nexport default TacticalMap;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"/app/src/components/widgets/Compass.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/components/widgets/IntelFeed.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/components/widgets/LayerFilters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/components/widgets/MissionNavigator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/components/widgets/SystemStatus.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/hooks/useMissionLocations.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":23,"column":9,"severity":2,"nodeType":null,"fix":{"range":[564,619],"text":" "}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\n\r\nexport interface MissionLocation {\r\n  id: string;\r\n  name: string;\r\n  lat: number;\r\n  lon: number;\r\n  radius_nm: number;\r\n  created_at: string;\r\n}\r\n\r\nconst STORAGE_KEY = 'sovereign_mission_locations';\r\nconst MAX_SAVED_MISSIONS = 50;\r\n\r\nexport const useMissionLocations = () => {\r\n  const [savedMissions, setSavedMissions] = useState<MissionLocation[]>([]);\r\n\r\n  // Load from localStorage on mount\r\n  useEffect(() => {\r\n    try {\r\n      const stored = localStorage.getItem(STORAGE_KEY);\r\n      if (stored) {\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n        setSavedMissions(JSON.parse(stored));\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load saved missions:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Persist to localStorage whenever missions change\r\n  useEffect(() => {\r\n    try {\r\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(savedMissions));\r\n    } catch (error) {\r\n      console.error('Failed to save missions:', error);\r\n    }\r\n  }, [savedMissions]);\r\n\r\n  const saveMission = (mission: Omit<MissionLocation, 'id' | 'created_at'>) => {\r\n    const newMission: MissionLocation = {\r\n      ...mission,\r\n      id: `mission-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,\r\n      created_at: new Date().toISOString(),\r\n    };\r\n\r\n    setSavedMissions((prev) => {\r\n      const updated = [newMission, ...prev];\r\n      // Enforce limit\r\n      return updated.slice(0, MAX_SAVED_MISSIONS);\r\n    });\r\n\r\n    return newMission;\r\n  };\r\n\r\n  const deleteMission = (id: string) => {\r\n    setSavedMissions((prev) => prev.filter((m) => m.id !== id));\r\n  };\r\n\r\n  const updateMission = (id: string, updates: Partial<Omit<MissionLocation, 'id' | 'created_at'>>) => {\r\n    setSavedMissions((prev) =>\r\n      prev.map((m) => (m.id === id ? { ...m, ...updates } : m))\r\n    );\r\n  };\r\n\r\n  return {\r\n    savedMissions,\r\n    saveMission,\r\n    deleteMission,\r\n    updateMission,\r\n  };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"/app/src/hooks/useSystemHealth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/src/workers/tak.worker.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/app/vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
