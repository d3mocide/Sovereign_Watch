# Sovereign Watch: Comprehensive Implementation Blueprint and Technical Roadmap for Distributed Multi-INT Fusion

## 1. Executive Summary

### 1.1 Strategic Vision: The Paradigm of Active Sovereignty

The contemporary global intelligence environment operates under a paradoxical condition: never before has so much data been generated by the digital exhaust of human activity, yet never has the ability to independently verify this data been so constrained by commercial intermediation.

Sovereign Watch defines a break from this dependency. It proposes a transition from a "Consumption Model" to an "Active Collection Model." By deploying a self-hosted, distributed fusion center, d3FRAG Networks seeks to reclaim data sovereignty. This platform is not merely a visualization tool; it is a "System of Systems" engineered to ingest raw, unfiltered telemetry from the "Fediverse of Things" (decentralized sensor networks), normalize disparate data formats into a military-standard schema (Cursor on Target / TAK Protocol), and apply hybrid artificial intelligence to extract semantic meaning from the chaos of raw signals.

### 1.2 The Strategic Pivot: Research-Driven Architecture

Following a rigorous technical audit (See `docs/research/`), the architecture has pivoted to address critical constraints in browser rendering and data volume:

1.  **Hybrid Rendering Engine**: Shifted from "Pure WebGPU" to **WebGL2 Interleaved Rendering** to solve depth occlusion (Z-buffering) issues with 3D terrain. WebGPU is retained solely as a headless compute engine for physics simulation ("Invisible WebGPU").
2.  **Protocol Efficiency**: Standardization on **TAK Protocol V1 (Protobuf)** instead of XML/JSON. This reduces bandwidth by ~83% and eliminates main-thread parsing bottlenecks for high-volume tracks (100k+ entities).
3.  **Pulse Ingestion**: Implementation of "Pulse" pipelines (Cron-based) for high-latency data sources like Space-Track (Orbital) and NOAA (Space Weather), decoupling them from the real-time streaming core.
4.  **Dynamic Sovereignty**: Shift from static, fixed-radius monitoring to **Dynamic Area Management (DAM)**. This enables operators to pivot the entire collection, processing, and visualization stack to any global coordinate instantly ("Agile Intelligence").

### 1.3 Architectural Directive

This report outlines a five-layer unbundled architecture designed to meet these challenges using commodity hardware and open-source software.

- **Ingestion**: Purpose-built Python async services for each INT domain (Aviation, Maritime), with future "Pulse" batching for high-latency sources (Orbital, Spectrum).
- **Streaming**: Redpanda (C++ Kafka) for low-latency, high-throughput event buffering.
- **Persistence**: TimescaleDB (PostgreSQL) with pgvectorscale for hybrid time-series and vector storage.
- **Cognition**: A Hybrid AI orchestration layer using LiteLLM to route sensitive tasks to local Edge AI (Jetson/Llama 3) and cloud models.
- **Visualization**: A React 18+ frontend leveraging Deck.gl (WebGL2) and Mapbox GL JS for "Digital Twin" fidelity.

## 2. Infrastructure and DevOps Architecture

(See original roadmap for network segmentation details. No major changes.)

## 3. The Ingestion Layer: Active Collection & Normalization

The validity of any intelligence product is determined by the quality of its source material.

### 3.1 Ingestion Architecture: Domain-Specific Python Services

Each INT domain is served by a purpose-built Python async service (`asyncio`), containerized independently. This replaced the original Benthos (Redpanda Connect) approach to enable domain-specific logic such as multi-source arbitration, dynamic area management, and per-source rate limiting that declarative YAML pipelines could not express cleanly.

### 3.2 Data Standardization: TAK Protocol (Protobuf)

The platform standardizes on **TAK Protocol Version 1**.

- **Format**: Protocol Buffers (binary).
- **Header**: Magic Bytes `0xbf 0x01 0xbf` prepended to every message for interoperability with ATAK/WinTAK clients.
- **Efficiency**: Enables zero-copy deserialization in the browser via Web Workers.

### 3.3 Aviation Intelligence: Multi-Source ADS-B Pipeline

- **Service**: `sovereign-adsb-poller` (Python async, `backend/ingestion/poller/`).
- **Sources**: Multi-source with weighted round-robin selection:
  - `adsb.fi` (40% weight) — Open data community aggregator.
  - `adsb.lol` (40% weight) — Community aggregator.
  - `airplanes.live` (20% weight) — Backup, strict rate limits.
- **Protocol**: HTTP Polling (~2s intervals, staggered per-source).
- **Mapping**: JSON -> TAK Protobuf (`a-f-A`).
- **Arbitration**: Cross-source deduplication cache (0.8s time gate, 50m spatial bypass) to prevent jitter from simultaneous multi-source reports.
- **Jitter Mitigation** (v0.3.0): Timestamp anchored to `_fetched_at` (HTTP response time), extrapolation capped at 1.0x, velocity-adaptive EWMA smoothing, trail point distance gating (30m threshold).
- **Dynamic Area**: Redis pub/sub for real-time mission area updates. 3 overlapping polling points for coverage >50nm.
- **Rate Limiting**: Per-source `aiolimiter` with exponential backoff and cooldown windows (30s-300s).

### 3.4 Maritime Intelligence: AISStream WebSocket Pipeline

- **Service**: `sovereign-ais-poller` (Python async, `backend/ingestion/maritime_poller/`).
- **Source**: aisstream.io (requires API key).
- **Protocol**: Secure WebSocket (real-time streaming, no polling overhead).
- **Mapping**: NMEA/JSON -> TAK Protobuf (`a-f-S-C-M`).
- **Dynamic Area**: Bounding box auto-calculated from mission center + radius. Refreshed on Redis pub/sub area update events.
- **Resilience**: Auto-reconnection with 5s delay, ping/pong keepalives on 30s inactivity.
- **Filtering**: `PositionReport` messages only (active position updates).

### 3.5 Orbital Intelligence: The Space-Track Pulse

- **Source**: Space-Track.org.
- **Protocol**: HTTP Pulse (6-hour interval).
- **Logic**: Stateful authentication (POST credentials -> Capture Cookie -> GET Data).
- **Output**: TAK Protobuf (`a-s-K` for Keplerian elements).

### 3.6 SIGINT & Spectrum: Jamming & SatNOGS

- **Jamming**: Aggregation of ADS-B Integrity indicators (NIC/NACp) by H3 Hexagon. Output: TAK Interference Object (`y-g-i`).
- **Spectrum**: SatNOGS waterfall verification (`status=good`). Output: TAK Observation (`r-s-g`).

## 4. The Persistence Layer: Time, Space, and Semantics

(Retained: TimescaleDB Hypertables + PostGIS + pgvectorscale).

## 5. The Cognitive Layer: Hybrid AI Orchestration

(Retained: LiteLLM Gateway, Local Whispers, Ollama).

## 6. The Presentation Layer: The "Glass"

The frontend is the "Single Pane of Glass" for the analyst.

### 6.1 Hybrid Rendering Architecture

- **Visual Layer (WebGL2)**: `MapboxOverlay` with `interleaved: true`. Renders tactical icons and paths _inside_ the Mapbox GL JS context to ensure proper occlusion by 3D terrain.
- **Compute Layer (WebGPU)**: "Invisible" Headless WebGPU Worker. Calculates positions for high-volume entities (e.g., "Agent Swarm" particles) and SGP4 orbital propagation. Transfers data to Main Thread via Zero-Copy `Float32Array`.

### 6.2 Tactical UI Design System ("Sovereign Glass")

- **Aesthetic**: Neon Noir / FUI (Fictional User Interface).
- **Architecture**: **Chevron-First**. Eliminated legacy dot markers in favor of unified, kite-style directional chevrons.
- **HUD Components**: High-fidelity modular shell featuring a global **TopBar** with synchronized UTC tactical clock and live state metadata.
- **Optics**: High-contrast vector pointers with integrated pulsing halos and reactive situational alert coloring.
- **Aesthetic Refinement**: Prioritized monitor-grade clarity using Micro-Noise grain and grid patterns. Removed legacy scanlines for professional situational awareness.
- **Interaction**: Unified hover/click logic directly on vector markers for seamless target locking and trail inspection.

## 7. Master Task List for AI Agents

### Completed

| ID             | Task Name          | Component | Description                                                                         |
| :------------- | :----------------- | :-------- | :---------------------------------------------------------------------------------- |
| **Infra-01**   | Docker Env         | DevOps    | **DONE**. 3-network isolation, Redpanda, TimescaleDB, Redis.                        |
| **Infra-02**   | Container Naming   | DevOps    | **DONE**. Renamed to `sovereign-adsb-poller`, `sovereign-ais-poller`.               |
| **DB-01**      | Schema             | Database  | **DONE**. Hypertables, compression, 24h retention policy.                           |
| **FE-01**      | Hybrid Map         | Frontend  | **DONE**. `MapboxOverlay` with `interleaved: true`, Chevron-First architecture.     |
| **FE-02**      | Design System      | Frontend  | **DONE**. Tactical HUD shell, TopBar, Sidebars, noise/grid overlays.                |
| **FE-03**      | Containerization   | Frontend  | **DONE**. Dockerfile + Vite HMR for live development.                               |
| **FE-04**      | Altitude Viz       | Frontend  | **DONE**. 10-stop altitude color gradient, 2D/3D toggle, floating icons.            |
| **FE-05**      | TAK Decoder        | Frontend  | **DONE**. Client-side Protobuf Web Worker with magic bytes validation.              |
| **FE-06**      | Track Summary      | Frontend  | **DONE**. Real-time AIR/SEA/ORBITAL counts with color-coded indicators.             |
| **FE-07**      | Dynamic Area (DAM) | Frontend  | **DONE**. Mission pivot, saved locations, adaptive zoom, Haversine cleanup.         |
| **Ingest-01**  | Aviation ADS-B     | Data Eng  | **DONE**. Multi-source Python poller (adsb.fi/lol/airplanes.live) with arbitration. |
| **Ingest-02**  | Maritime AIS       | Data Eng  | **DONE**. Python WebSocket poller (AISStream.io) with DAM integration.              |
| **Ingest-06**  | Gap 3 Smart Poller | Data Eng  | **DONE**. Staggered multi-source polling, per-source rate limiting.                 |
| **Backend-01** | Fusion API         | Backend   | **DONE**. FastAPI with WebSocket `/api/tracks/live` + SSE analysis.                 |
| **Backend-02** | Track Feed API     | Backend   | **DONE**. Multi-topic Kafka consumer (`adsb_raw` + `ais_raw`).                      |
| **Backend-03** | Historian          | Backend   | **DONE**. `kafka-to-timescale` consumer for track persistence.                      |
| **FE-08**      | Search             | Frontend  | **DONE**. Callsign/UID search widget with autocomplete.                             |
| **FE-11**      | Replay System      | Frontend  | **DONE**. Historic time-slider synchronized with Historian service.                 |
| **FE-19**      | Refined Optics     | Frontend  | **DONE**. 3D Altitude centering, Synchronized Telemetry, Tactical Zoom (v0.5.0).    |
| **Ingest-03**  | Orbital Pulse      | Data Eng  | **DONE**. Celestrak TLE fetch → SGP4 propagation → `orbital_raw` Kafka topic.       |
| **FE-20**      | Orbital Viz        | Frontend  | **DONE**. `OrbitalLayer.tsx`: satellite icons, ground tracks, footprint circles.    |

### Next Priority (P0–P1)

| ID             | Task Name               | Component | Description                                                                                                                                                             |
| :------------- | :---------------------- | :-------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Audit-01**   | **Code Review**         | Security  | **(P1)**. Full codebase audit, linting, and security scan.                                                                                                              |
| **Fix-01**     | **CoT Tracking**        | Frontend  | **(P1)**. Restore functional Cursor-on-Target event tracking.                                                                                                           |
| **FE-21**      | Undersea Cable Layer    | Frontend  | **(P1)**. `CableLayer.tsx`: animated fiber routes (TeleGeography GeoJSON), landing station markers, cable metadata popup, INFRA toggle in LayerFilters.                 |
| **Ingest-07a** | ADS-B Drone Enhancement | Data Eng  | **(P1)**. Expand drone ICAO type-code detection, squawk 7400 forced classification, drone sub-type (`MILITARY_UAS`/`COMMERCIAL_UAS`/`CIVIL_UAS`) tagging in TAK detail. |
| **FE-22**      | Drone Tactical Layer    | Frontend  | **(P1)**. Dedicated drone rotor-icon layer, operator position link line (Remote ID), DroneDetail sidebar panel.                                                         |

### Backlog (P2)

| ID             | Task Name        | Component | Description                                                                                    |
| :------------- | :--------------- | :-------- | :--------------------------------------------------------------------------------------------- |
| **FE-09**      | Coverage Viz     | Frontend  | H3 polling fidelity visualization.                                                             |
| **FE-10**      | Payload Eval     | Frontend  | Raw JSON inspector (Terminal Mode).                                                            |
| **FE-12**      | Settings UI      | Frontend  | Configure API keys/Pollers via UI (no more ENV editing).                                       |
| **FE-13**      | Mission Labels   | Frontend  | Floating text labels for coverage areas.                                                       |
| **FE-14**      | Deep Linking     | Frontend  | Shareable URLs with encoded mission state.                                                     |
| **FE-15**      | Data Portability | Frontend  | Import/Export Mission Presets (JSON).                                                          |
| **Backend-04** | Auth/RBAC        | Backend   | User management & Role-Based Access Control.                                                   |
| **Ingest-07**  | Drone Remote ID  | Data Eng  | OpenDroneID / FAA Remote ID SDR pipeline → `drone_raw` Kafka topic. Requires RTL-SDR hardware. |

### Future (P3 — Phase 6+)

| ID             | Task Name      | Component | Description                                                |
| :------------- | :------------- | :-------- | :--------------------------------------------------------- |
| **Backend-05** | Multi-Area     | Backend   | Concurrent polling engine for multiple surveillance zones. |
| **FE-16**      | Analytics Dash | Frontend  | Mission heatmaps & metrics.                                |
| **FE-17**      | Collab Sync    | Frontend  | Multi-user WebSocket mission sync.                         |
| **Ingest-04**  | SIGINT/Jamming | Data Eng  | H3 Integrity aggregation (NIC/NACp).                       |
| **Ingest-05**  | Spectrum       | Data Eng  | SatNOGS integration.                                       |
| **FE-18**      | WebGPU Physics | Frontend  | Headless compute worker for Boids/SGP4.                    |
| **AI-01**      | AI Analyst     | Backend   | Deep AI-driven analysis (Phase 8).                         |

---

_Updated 2026-02-20. Phase 8 feature plan added (Orbital, Undersea Cable, Drone). See `docs/FEATURE-ROADMAP-PHASE-8.md` for full architecture and agent prompts._
